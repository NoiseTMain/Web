<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Rozpis slu≈æeb - Obo≈ôi≈°tƒõ</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root{--bg:#f6f7fb;--card:#ffffff;--muted:#6b7280;--accent:#2563eb;--accent2:#10b981;--glass:rgba(255,255,255,0.6);--border:rgba(0,0,0,0.06);--text:#0f1724;}
[data-theme='dark']{--bg:#05060a;--card:rgba(20,25,30,0.6);--muted:#bfc8d2;--accent:#1e40af;--accent2:#047857;--glass:rgba(255,255,255,0.02);--border:rgba(255,255,255,0.06);--text:#fdf6e3;}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%; font-family:Inter,"Segoe UI",Tahoma,sans-serif; background:linear-gradient(180deg,var(--bg),#eef2ff); color:var(--text); padding-bottom:40px; transition:all .25s; overflow-x:hidden;}
header{position:relative; z-index:5; background:linear-gradient(90deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); padding:20px 18px; display:flex; gap:12px; align-items:center; justify-content:space-between; border-bottom:14px solid rgba(230,230,230,0.9); border-image:url('https://www.transparenttextures.com/patterns/marble.png') 30 repeat; color:var(--text);}
.title h1{font-size:20px;margin-bottom:4px;}
.title .sub{font-size:12px;color:var(--muted);}
.wrap{max-width:1100px;margin:16px auto;padding:0 18px;position:relative;z-index:5;}
.topbar{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px;}
.card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 8px 30px rgba(15,23,42,0.06);border:1px solid var(--border);transition:transform .18s ease, box-shadow .18s ease, background .25s;backdrop-filter: blur(6px);}
.card:hover{transform: translateY(-4px); box-shadow:0 18px 40px rgba(2,6,23,0.08);}
.nav{display:flex; gap:8px; background:transparent; padding:6px; border-radius:10px;}
.nav button{background:transparent; border:1px solid var(--border); padding:8px 12px; border-radius:8px; cursor:pointer; color:var(--muted); font-weight:700;}
.nav button.active{ background:linear-gradient(90deg,var(--accent),#2b6ef6); color:#fff; border-color:transparent;}
.form-row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:8px; }
input[type=text], input[type=date], select, textarea{padding:10px 12px; border-radius:8px; border:1px solid var(--border); min-width:150px; background:transparent; color:var(--text);}
.btn{ display:inline-flex; gap:8px; align-items:center; padding:10px 14px; border-radius:10px; border:none; background:var(--accent); color:#fff; cursor:pointer; font-weight:700; }
.btn.secondary{ background:transparent; color:var(--muted); border:1px solid var(--border); font-weight:700; }
.student-list{ list-style:none; margin-top:10px; display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:10px; padding:0; }
.student-item{ display:flex; align-items:center; gap:10px; padding:10px; border-radius:10px; border:1px solid var(--border); background:linear-gradient(180deg,var(--glass),transparent); cursor:pointer;}
.student-item .name{ font-weight:700; color:var(--text) }
.student-item .meta{ margin-left:auto; display:flex; gap:8px; align-items:center }
.table-wrap{ overflow:auto; margin-top:8px }
table.main{ width:100%; border-collapse:collapse; min-width:720px; background:var(--card); border-radius:8px; overflow:hidden; }
table.main thead th{ text-align:left; padding:12px; background:var(--accent); color:#fff; font-weight:800; font-size:0.95em; }
table.main tbody td{ padding:12px; border-bottom:1px dashed rgba(0,0,0,0.06); vertical-align:middle; color:var(--text) }
.badge{ display:inline-block; padding:6px 8px; border-radius:8px; background:linear-gradient(90deg,var(--accent2),#34d399); color:#fff; font-weight:700; }
.badge-sick{background:linear-gradient(90deg,#ef4444,#f87171);}
.muted{ color:var(--muted); font-size:0.88em; }
.modal-bg{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);display:none;align-items:center;justify-content:center;z-index:100;}
.modal{background:var(--card);padding:20px;border-radius:12px;max-width:400px;width:100%;position:relative;}
.modal h3{margin-bottom:12px;}
.modal label{display:block;margin:6px 0;font-weight:700;}
.modal input, .modal textarea{width:100%;padding:8px;border-radius:6px;border:1px solid var(--border);margin-bottom:8px;}
.modal button{margin-top:8px;}
</style>
</head>
<body data-theme="light">

<header>
  <div class="title">
    <h1>Rozpis slu≈æeb - Obo≈ôi≈°tƒõ</h1>
    <div class="sub muted">Pl√°novaƒç smƒõn kuchynƒõ ‚Äî modernƒõ a p≈ôehlednƒõ</div>
  </div>
  <div>
    <button class="btn secondary" onclick="toggleTheme()">P≈ôepnout motiv</button>
    <button class="btn secondary" onclick="sendEmail()">üìß Odeslat rozpis</button>
  </div>
</header>

<main class="wrap">
  <div class="card">
    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <input type="text" id="newStudent" placeholder="Jm√©no ≈æ√°ka"/>
      <button class="btn" onclick="addStudent()">P≈ôidat ≈æ√°ka</button>
    </div>
  </div>

  <div class="card" id="scheduleCard">
    <div class="table-wrap">
      <table class="main" id="mainTable">
        <thead>
          <tr><th>Od</th><th>Do</th><th>≈Ω√°k</th><th>Pozn√°mka</th></tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <h3>Seznam ≈æ√°k≈Ø</h3>
    <div id="studentList" class="student-list"></div>
  </div>
</main>

<div class="modal-bg" id="studentModal">
  <div class="modal">
    <h3 id="modalName"></h3>
    <label>Pozn√°mka</label>
    <textarea id="modalNote"></textarea>
    <label>Nemoc od</label>
    <input type="date" id="modalSickFrom"/>
    <label>Nemoc do</label>
    <input type="date" id="modalSickTo"/>
    <div style="margin:6px 0;"><span id="sickBadge" class="badge badge-sick" style="display:none;">Nemocn√Ω</span></div>
    <button class="btn" onclick="saveProfile()">Ulo≈æit</button>
    <button class="btn secondary" onclick="deleteStudentFromModal()">Smazat ≈æ√°ka</button>
    <button class="btn secondary" onclick="closeModal()">Zav≈ô√≠t</button>
  </div>
</div>

<script>
let store = JSON.parse(localStorage.getItem('students')||'[]');
let currentAssignments = [];
let modalStudent = null;

function saveStore(){ localStorage.setItem('students', JSON.stringify(store)); }
function $(id){ return document.getElementById(id); }

function addStudent(){
  const val = $('newStudent').value.trim();
  if(!val) return alert('Zadej jm√©no.');
  if(store.some(s=>s.name.toLowerCase()===val.toLowerCase())) return alert('≈Ω√°k ji≈æ existuje.');
  store.push({name: val, note:'', sickFrom:null, sickTo:null});
  $('newStudent').value='';
  redrawAll();
  saveStore();
}

function isSick(s){
  const now = new Date();
  const from = s.sickFrom?new Date(s.sickFrom):null;
  const to = s.sickTo?new Date(s.sickTo):null;
  if(!from) return false;
  if(to) return now>=from && now<=to;
  return now>=from;
}

function openModal(student){
  modalStudent = student;
  $('modalName').textContent = student.name;
  $('modalNote').value = student.note||'';
  $('modalSickFrom').value = student.sickFrom||'';
  $('modalSickTo').value = student.sickTo||'';
  $('sickBadge').style.display = isSick(student)?'inline-block':'none';
  $('studentModal').style.display='flex';
}

function closeModal(){ $('studentModal').style.display='none'; modalStudent=null; }

function saveProfile(){
  if(!modalStudent) return;
  modalStudent.note = $('modalNote').value;
  modalStudent.sickFrom = $('modalSickFrom').value||null;
  modalStudent.sickTo = $('modalSickTo').value||null;
  closeModal();
  redrawAll();
  saveStore();
}

function deleteStudentFromModal(){
  if(!modalStudent) return;
  store = store.filter(s=>s!==modalStudent);
  closeModal();
  redrawAll();
  saveStore();
}

function renderStudents(){
  const container = $('studentList'); container.innerHTML='';
  store.forEach(s=>{
    const div = document.createElement('div'); div.className='student-item';
    div.innerHTML=`<div class="name">${s.name}${isSick(s)?' <span class="badge badge-sick">Nemocn√Ω</span>':''}</div>`;
    div.onclick = ()=>openModal(s);
    container.appendChild(div);
  });
}

function generateAssignments(){
  const weeks = Math.max(4, store.length);
  const out=[];
  const today = new Date();
  let idx=0;
  for(let w=0; w<weeks; w++){
    if(store.length===0) break;
    let student = store[idx%store.length];
    while(isSick(student)){
      idx++;
      student = store[idx%store.length];
    }
    const start = new Date(today.getFullYear(), today.getMonth(), today.getDate() + w*7);
    const end = new Date(start.getFullYear(), start.getMonth(), start.getDate()+6);
    out.push({start,end,student:student.name,note:student.note||''});
    idx++;
  }
  return out;
}

function renderTable(){
  currentAssignments = generateAssignments();
  const tbody = $('tableBody'); tbody.innerHTML='';
  currentAssignments.forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.start.toLocaleDateString()}</td><td>${r.end.toLocaleDateString()}</td><td>${r.student}</td><td>${r.note}</td>`;
    tbody.appendChild(tr);
  });
}

function redrawAll(){ renderStudents(); renderTable(); }

function toggleTheme(){
  const body = document.body;
  body.setAttribute('data-theme', body.getAttribute('data-theme')==='light'?'dark':'light');
}

function sendEmail(){
  let body = 'Rozpis slu≈æeb:\n\n';
  currentAssignments.forEach(r=>{
    body+=`${r.start.toLocaleDateString()} - ${r.end.toLocaleDateString()}: ${r.student}\n`;
  });
  const mailto = `mailto:?subject=Rozpis slu≈æeb&body=${encodeURIComponent(body)}`;
  window.location.href = mailto;
}

redrawAll();
</script>
</body>
</html>
